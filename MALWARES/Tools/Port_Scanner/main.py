import sys
import socket
import datetime
import threading

class bcolors:
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    RED = '\033[91m'

def scan_port(target, port, file=None,a=0):
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        socket.setdefaulttimeout(1)
        result = s.connect_ex((target, port))
        if result == 0:
            print(bcolors.GREEN + f"{port} is open at {target}")
            if file:
                file.write(f"This Port is open {port} at {target}\n")
        if a == 1:
            print(bcolors.RED + f"{port} Closed at {target}\n")
        s.close()

    except Exception as e:
        pass

if len(sys.argv) < 3 or len(sys.argv) > 4:
    print(bcolors.RED + "Syntax: sudo python3.11 main.py <all or passed> <ip> [output_file] Exp: sudo python3.11 main.py all 10.0.0.2 output.txt")
    sys.exit(1)

target = socket.gethostbyname(sys.argv[2])
scanning_mode = sys.argv[1]


if len(sys.argv) == 4:
    output_file = open(sys.argv[3], 'a')
else:
    output_file = None

print(bcolors.YELLOW + '''ooooooooo.                          .   ooooo                 .oooooo..o                                 
`888   `Y88.                      .o8   `888'                d8P'    `Y8                                 
 888   .d88'  .ooooo.  oooo d8b .o888oo  888   .ooooo.       Y88bo.       .ooooo.   .oooo.   ooo. .oo.   
 888ooo88P'  d88' `88b `888""8P   888    888  d88' `"Y8       `"Y8888o.  d88' `"Y8 `P  )88b  `888P"Y88b  
 888         888   888  888       888    888  888                 `"Y88b 888        .oP"888   888   888  
 888         888   888  888       888 .  888  888   .o8      oo     .d8P 888   .o8 d8(  888   888   888  
o888o        `Y8bod8P' d888b      "888" o888o `Y8bod8P'      8""88888P'  `Y8bod8P' `Y888""8o o888o o888o 
                                                                                                         \n\nCopyright Atharva, Tiwari 2023\n''')
print(bcolors.YELLOW + '-' * 50)
print(bcolors.YELLOW + "Looking For IP: " + target)
print(bcolors.YELLOW + "Time Started: " + str(datetime.datetime.now()))
print(bcolors.YELLOW + '-' * 50)

threads = []

try:
    y = 0
    if scanning_mode == "all":
        y = 1
    for port in range(1, 60000):
        thread = threading.Thread(target=scan_port, args=(target, port, output_file,y))
        thread.start()
        threads.append(thread)

    for thread in threads:
        thread.join()

except KeyboardInterrupt:
    print(bcolors.RED + "\nExiting\n")
except Exception as e:
    print(bcolors.RED + "\nUnexpected Error Occurred Exiting\n")
finally:
    if output_file:
        output_file.close()
